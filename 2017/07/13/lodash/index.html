<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="海阔天空的博客"><meta name="keywords" content="zhg-645479206,海阔天空,zhg,博客"><title>lodash | 海阔天空</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">lodash</h1><a id="logo" href="/.">海阔天空</a><p class="description">做个灵魂有香气的男人</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">lodash</h1><div class="post-meta"><span class="date">Jul 13, 2017</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i> Hits</i></i></span><a href="/2017/07/13/lodash/#comments" class="comment-count">留言</a></div><div class="post-content"><p>有多年开发经验的工程师，往往都会有自己的一套工具库，称为 utils、helpers等等，这套库一方面是自己的技术积累，另一方面也是对某项技术的扩展，领先于技术规范的制定和实现。</p>
<p>Lodash就是这样的一套工具库，它内部封装了诸多对字符串、数组、对象等常见数据类型的处理函数，其中部分是目前 ECMAScript 尚未制定的规范，但同时被业界所认可的辅助函数。目前每天使用 npm 安装 Lodash 的数量在百万级以上，这在一定程度上证明了其代码的健壮性，值得我们在项目中一试。</p>
<blockquote>
<p>转载自 pinggod 的 <a href="http://www.jianshu.com/p/7436e40ac5d1" target="_blank" rel="external">http://www.jianshu.com/p/7436e40ac5d1</a></p>
</blockquote>
<p><a href="http://lodashjs.com/docs/#_slicearray-start0-endarraylength" target="_blank" rel="external">lodash中文文档</a></p>
<h2 id="模块组成"><a href="#模块组成" class="headerlink" title="模块组成"></a>模块组成</h2><p>Lodash 提供的辅助函数主要分为以下几类，函数列表和用法实例请查看 <a href="https://lodash.com/docs/4.17.4" target="_blank" rel="external">Lodash 的官方文档</a></p>
<ul>
<li><em>Array</em>，适用于数组类型，比如填充数据、查找元素、数组分片等操作</li>
<li><em>Collection</em>，适用于数组和对象类型，部分适用于字符串，比如分组、查找、过滤等操作</li>
<li><em>Function</em>，适用于函数类型，比如节流、延迟、缓存、设置钩子等操作</li>
<li><em>Lang</em>，普遍适用于各种类型，常用于执行类型判断和类型转换</li>
<li><em>Math</em>，适用于数值类型，常用于执行数学运算</li>
<li><em>Number</em>，适用于生成随机数，比较数值与数值区间的关系</li>
<li><em>Object</em>，适用于对象类型，常用于对象的创建、扩展、类型转换、检索、集合等操作</li>
<li><em>Seq</em>，常用于创建链式调用，提高执行性能（惰性计算）</li>
<li><em>String</em>，适用于字符串类型</li>
</ul>
<hr>
<p><em>lodash/fp</em> 模块提供了更接近函数式编程的开发方式，其内部的函数经过包装，具有 immutable、auto-curried、iteratee-first、data-last（官方介绍）等特点。Lodash 在 <a href="https://github.com/lodash/lodash/wiki/FP-Guide" target="_blank" rel="external">GitHub Wiki</a> 中对 lodash/fp 的特点做了如下概述：</p>
<ul>
<li>Fixed Arity，固化参数个数，便于柯里化</li>
<li>Rearragned Arguments，重新调整参数位置，便于函数之间的聚合</li>
<li>Capped Iteratee Argument，封装 Iteratee 参数</li>
<li>New Methods</li>
</ul>
<blockquote>
<p>In functional programming, an iteratee is a composable abstraction for incrementally processing sequentially presented chunks of input data in a purely functional fashion. With iteratees, it is possible to lazily transform how a resource will emit data, for example, by converting each chunk of the input to uppercase as they are retrieved or by limiting the data to only the five first chunks without loading the whole input data into memory. Iteratees are also responsible for opening and closing resources, providing predictable resource management. ———— iteratee, wikipedia</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">// The `lodash/map` iteratee receives three arguments:</div><div class="line">// (value, index|key, collection)</div><div class="line">_.map([<span class="string">'6'</span>, <span class="string">'8'</span>, <span class="string">'10'</span>], parseInt);</div><div class="line">// → [6, NaN, 2]</div><div class="line"></div><div class="line">// The `lodash/fp/map` iteratee is capped at one argument:</div><div class="line">// (value)</div><div class="line">fp.map(parseInt)([<span class="string">'6'</span>, <span class="string">'8'</span>, <span class="string">'10'</span>]);</div><div class="line">// → [6, 8, 10]</div><div class="line"></div><div class="line"></div><div class="line">// `lodash/padStart` accepts an optional `chars` param.</div><div class="line">_.padStart(<span class="string">'a'</span>, 3, <span class="string">'-'</span>)</div><div class="line">// → <span class="string">'--a'</span></div><div class="line"></div><div class="line">// `lodash/fp/padStart` does not.</div><div class="line">fp.padStart(3)(<span class="string">'a'</span>);</div><div class="line">// → <span class="string">'  a'</span></div><div class="line">fp.padCharsStart(<span class="string">'-'</span>)(3)(<span class="string">'a'</span>);</div><div class="line">// → <span class="string">'--a'</span></div><div class="line"></div><div class="line"></div><div class="line">// `lodash/filter` is data-first iteratee-last:</div><div class="line">// (collection, iteratee)</div><div class="line">var compact = _.partial(_.filter, _, Boolean);</div><div class="line">compact([<span class="string">'a'</span>, null, <span class="string">'c'</span>]);</div><div class="line">// → [<span class="string">'a'</span>, <span class="string">'c'</span>]</div><div class="line"></div><div class="line">// `lodash/fp/filter` is iteratee-first data-last:</div><div class="line">// (iteratee, collection)</div><div class="line">var compact = fp.filter(Boolean);</div><div class="line">compact([<span class="string">'a'</span>, null, <span class="string">'c'</span>]);</div><div class="line">// → [<span class="string">'a'</span>, <span class="string">'c'</span>]</div></pre></td></tr></table></figure>
<p>在 React + Webpack + Babel(ES6) 的开发环境中，使用 Lodash 需要安装插件 <a href="https://www.npmjs.com/package/babel-plugin-lodash" target="_blank" rel="external">babel-plugin-lodash</a> 并更新 Babel 配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save lodash</div><div class="line">npm install --save-dev babel-plugin-lodash</div></pre></td></tr></table></figure>
<p>更新 Babel 的配置文件 .babelrc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"presets"</span>: [</div><div class="line">        <span class="string">"react"</span>,</div><div class="line">        <span class="string">"es2015"</span>,</div><div class="line">        <span class="string">"stage-0"</span></div><div class="line">    ],</div><div class="line">    <span class="string">"plugins"</span>: [</div><div class="line">        <span class="string">"lodash"</span></div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">import _ from <span class="string">'lodash'</span>;</div><div class="line">import &#123; add &#125; from <span class="string">'lodash/fp'</span>;</div><div class="line"></div><div class="line">const addOne = add(1);</div><div class="line">_.map([1, 2, 3], addOne);</div></pre></td></tr></table></figure>
<h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><hr>
<p>在 Filip Zawada 的文章<a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation/" target="_blank" rel="external">《How to Speed Up Lo-Dash ×100? Introducing Lazy Evaluation》</a> 中提到了 Lodash提高执行速度的思路，主要有三点：Lazy Evaluation、Pipelining 和 Deferred Execution。下面两张图来自 Filip 的博客：</p>
<p><img src="http://osmk5oivt.bkt.clouddn.com/lodash-naive.gif" alt=""></p>
<p>假设有如上图所示的问题：从若干个球中取出三个面值小于 10 的球。第一步是从所有的球中取出所有面值小于 10 的球，第二步是从上一步的结果取三个球。</p>
<p><img src="http://osmk5oivt.bkt.clouddn.com/grafika.gif" alt=""></p>
<p>上图是另一种解决方案，如果一个球能够通过第一步，那么就继续执行第二步，直至结束然后测试下一个球……当我们取到三个球之后就中断整个循环。Filip 称这是 Lazy Evaluation Algorithm，就个人理解这并不全面，他后续提到的 Pipelining(管道计算)，再加上一个中断循环执行的算法应该更符合这里的图示。</p>
<p>此外，使用 Lodash 的链式调用时，只有显示或隐式调用 .value 方法才会对链式调用的整个操作进行取值，这种不在声明时立即求值，而在使用时求值的方式，是 Lazy Evaluation 最大的特点。</p>
<h3 id="九个实例"><a href="#九个实例" class="headerlink" title="九个实例"></a>九个实例</h3><hr>
<p>受益于 Lodash 的普及程度，使用它可以提高多人开发时阅读代码的效率，减少彼此之间的误解（Loss of Consciousness）。在<a href="http://colintoh.com/blog/lodash-10-javascript-utility-functions-stop-rewriting" target="_blank" rel="external">《Lodash: 10 Javascript Utility Functions That You Should Probably Stop Rewriting》</a>一文中，作者列举了多个常用的 Lodash 函数，实例演示了使用 Lodash 的技巧。</p>
<h3 id="1-N-次循环"><a href="#1-N-次循环" class="headerlink" title="1.N 次循环"></a>1.N 次循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 1. Basic <span class="keyword">for</span> loop.</div><div class="line"><span class="keyword">for</span>(var i = 0; i &lt; 5; i++) &#123;</div><div class="line">    // ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 2. Using Array<span class="string">'s join and split methods</span></div><div class="line">Array.apply(null, Array(5)).forEach(function()&#123;</div><div class="line">    // ...</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.times(5, function()&#123;</div><div class="line">    // ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>for 语句是执行循环的不二选择，Array.apply 也可以模拟循环，但在上面代码的使用场景下，_.times() 的解决方式更加简洁和易于理解。</p>
<h3 id="2-深层查找属性值"><a href="#2-深层查找属性值" class="headerlink" title="2.深层查找属性值"></a>2.深层查找属性值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// Fetch the name of the first pet from each owner</div><div class="line">var ownerArr = [&#123;</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"Colin"</span>,</div><div class="line">    <span class="string">"pets"</span>: [&#123;<span class="string">"name"</span>:<span class="string">"dog1"</span>&#125;, &#123;<span class="string">"name"</span>: <span class="string">"dog2"</span>&#125;]</div><div class="line">&#125;, &#123;</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"John"</span>,</div><div class="line">    <span class="string">"pets"</span>: [&#123;<span class="string">"name"</span>:<span class="string">"dog3"</span>&#125;, &#123;<span class="string">"name"</span>: <span class="string">"dog4"</span>&#125;]</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// Array<span class="string">'s map method.</span></div><div class="line">ownerArr.map(function(owner)&#123;</div><div class="line">   return owner.pets[0].name;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.map(ownerArr, 'pets[0].name<span class="string">');</span></div></pre></td></tr></table></figure>
<p>_.map 方法是对原生 map 方法的改进，其中使用 pets[0].name 字符串对嵌套数据取值的方式简化了很多冗余的代码，非常类似使用 jQuery 选择 DOM 节点 ul &gt; li &gt; a，对于前端开发者来说有种久违的亲切感。</p>
<h3 id="3-个性化数组"><a href="#3-个性化数组" class="headerlink" title="3.个性化数组"></a>3.个性化数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// Array<span class="string">'s map method.</span></div><div class="line">Array.apply(null, Array(6)).map(function(item, index)&#123;</div><div class="line">    return "ball_" + index;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.times(6, _.uniqueId.bind(null, 'ball_<span class="string">'));</span></div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.times(6, _.partial(_.uniqueId, 'ball_<span class="string">'));</span></div><div class="line">// eg. [ball_0, ball_1, ball_2, ball_3, ball_4, ball_5]</div></pre></td></tr></table></figure>
<p>在上面的代码中，我们要创建一个初始值不同、长度为 6 的数组，其中 _.uniqueId 方法用于生成独一无二的标识符（递增的数字，在程序运行期间保持独一无二），_partial 方法是对 bind 的封装。</p>
<h3 id="4-深拷贝"><a href="#4-深拷贝" class="headerlink" title="4.深拷贝"></a>4.深拷贝</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var objA = &#123;</div><div class="line">    <span class="string">"name"</span>: <span class="string">"colin"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">// Normal method? Too long. See Stackoverflow <span class="keyword">for</span> solution:</div><div class="line">// http://stackoverflow.com/questions/4459928/how-to-deep-clone-in-javascript</div><div class="line"></div><div class="line">// Lodash</div><div class="line">var objB = _.cloneDeep(objA);</div><div class="line">objB === objA // <span class="literal">false</span></div></pre></td></tr></table></figure>
<p>JavaScript 没有直接提供深拷贝的函数，但我们可以用其他函数来模拟，比如 JSON.parse(JSON.stringify(objectToClone))，但这种方法要求对象中的属性值不能是函数。Lodash 中的 _.cloneDeep 函数封装了深拷贝的逻辑，用起来更加简洁。</p>
<h3 id="5-随机数"><a href="#5-随机数" class="headerlink" title="5.随机数"></a>5.随机数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Naive utility method</div><div class="line"><span class="keyword">function</span> getRandomNumber(min, max)&#123;</div><div class="line">    <span class="built_in">return</span> Math.floor(Math.random() * (max - min + 1)) + min;</div><div class="line">&#125;</div><div class="line"></div><div class="line">getRandomNumber(15, 20);</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.random(15, 20);</div></pre></td></tr></table></figure>
<p>Lodash 的随机数生成函数更贴近实际开发，ECMAScript 的随机数生成函数是底层必备的接口，两者都不可或缺。此外，使用 _.random(15, 20, true) 还可以在 15 到 20 之间生成随机的浮点数。</p>
<h3 id="6-对象扩展"><a href="#6-对象扩展" class="headerlink" title="6.对象扩展"></a>6.对象扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// Adding extend <span class="keyword">function</span> to Object.prototype</div><div class="line">Object.prototype.extend = <span class="keyword">function</span>(obj) &#123;</div><div class="line">    <span class="keyword">for</span> (var i <span class="keyword">in</span> obj) &#123;</div><div class="line">        <span class="keyword">if</span> (obj.hasOwnProperty(i)) &#123;</div><div class="line">            this[i] = obj[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var objA = &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>, <span class="string">"car"</span>: <span class="string">"suzuki"</span>&#125;;</div><div class="line">var objB = &#123;<span class="string">"name"</span>: <span class="string">"james"</span>, <span class="string">"age"</span>: 17&#125;;</div><div class="line"></div><div class="line">objA.extend(objB);</div><div class="line">objA; // &#123;<span class="string">"name"</span>: <span class="string">"james"</span>, <span class="string">"age"</span>: 17, <span class="string">"car"</span>: <span class="string">"suzuki"</span>&#125;;</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.assign(objA, objB);</div></pre></td></tr></table></figure>
<p>_.assign 是浅拷贝，和 ES6 新增的 Ojbect.assign 函数功能一致（建议优先使用 Object.assign）。</p>
<h3 id="7-筛选属性"><a href="#7-筛选属性" class="headerlink" title="7.筛选属性"></a>7.筛选属性</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// Naive method: Remove an array of keys from object</div><div class="line">Object.prototype.remove = <span class="keyword">function</span>(arr) &#123;</div><div class="line">    var that = this;</div><div class="line">    arr.forEach(<span class="keyword">function</span>(key)&#123;</div><div class="line">        delete(that[key]);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var objA = &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>, <span class="string">"car"</span>: <span class="string">"suzuki"</span>, <span class="string">"age"</span>: 17&#125;;</div><div class="line"></div><div class="line">objA.remove([<span class="string">'car'</span>, <span class="string">'age'</span>]);</div><div class="line">objA; // &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>&#125;</div><div class="line"></div><div class="line">// Lodash</div><div class="line">objA = _.omit(objA, [<span class="string">'car'</span>, <span class="string">'age'</span>]);</div><div class="line">// =&gt; &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>&#125;</div><div class="line">objA = _.omit(objA, <span class="string">'car'</span>);</div><div class="line">// =&gt; &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>, <span class="string">"age"</span>: 17&#125;;</div><div class="line">objA = _.omit(objA, _.isNumber);</div><div class="line">// =&gt; &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>&#125;;</div></pre></td></tr></table></figure>
<p>大多数情况下，Lodash 所提供的辅助函数都会比原生的函数更贴近开发需求。在上面的代码中，开发者可以使用数组、字符串以及函数的方式筛选对象的属性，并且最终会返回一个新的对象，中间执行筛选时不会对旧对象产生影响。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// Naive method: Returning a new object with selected properties</div><div class="line">Object.prototype.pick = <span class="keyword">function</span>(arr) &#123;</div><div class="line">    var _this = this;</div><div class="line">    var obj = &#123;&#125;;</div><div class="line">    arr.forEach(<span class="keyword">function</span>(key)&#123;</div><div class="line">        obj[key] = _this[key];</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="built_in">return</span> obj;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var objA = &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>, <span class="string">"car"</span>: <span class="string">"suzuki"</span>, <span class="string">"age"</span>: 17&#125;;</div><div class="line"></div><div class="line">var objB = objA.pick([<span class="string">'car'</span>, <span class="string">'age'</span>]);</div><div class="line">// &#123;<span class="string">"car"</span>: <span class="string">"suzuki"</span>, <span class="string">"age"</span>: 17&#125;</div><div class="line"></div><div class="line">// Lodash</div><div class="line">var objB = _.pick(objA, [<span class="string">'car'</span>, <span class="string">'age'</span>]);</div><div class="line">// &#123;<span class="string">"car"</span>: <span class="string">"suzuki"</span>, <span class="string">"age"</span>: 17&#125;</div></pre></td></tr></table></figure>
<p><em>.pick 是 </em>.omit 的相反操作，用于从其他对象中挑选属性生成新的对象。</p>
<h3 id="8-随机元素"><a href="#8-随机元素" class="headerlink" title="8.随机元素"></a>8.随机元素</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var luckyDraw = [<span class="string">"Colin"</span>, <span class="string">"John"</span>, <span class="string">"James"</span>, <span class="string">"Lily"</span>, <span class="string">"Mary"</span>];</div><div class="line"></div><div class="line"><span class="keyword">function</span> pickRandomPerson(luckyDraw)&#123;</div><div class="line">    var index = Math.floor(Math.random() * (luckyDraw.length -1));</div><div class="line">    <span class="built_in">return</span> luckyDraw[index];</div><div class="line">&#125;</div><div class="line"></div><div class="line">pickRandomPerson(luckyDraw); // John</div><div class="line"></div><div class="line">// Lodash</div><div class="line">_.sample(luckyDraw); // Colin</div><div class="line"></div><div class="line">// Lodash - Getting 2 random item</div><div class="line">_.sample(luckyDraw, 2); // [<span class="string">'John'</span>,<span class="string">'Lily'</span>]</div></pre></td></tr></table></figure>
<p>_.sample 支持随机挑选多个元素并返回心的数组。</p>
<h3 id="9-针对-JSON-parse-的错误处理"><a href="#9-针对-JSON-parse-的错误处理" class="headerlink" title="9.针对 JSON.parse 的错误处理"></a>9.针对 JSON.parse 的错误处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// Using try-catch to handle the JSON.parse error</div><div class="line"><span class="keyword">function</span> parse(str)&#123;</div><div class="line">    try &#123;</div><div class="line">        <span class="built_in">return</span> JSON.parse(str);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    catch(e) &#123;</div><div class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// With Lodash</div><div class="line"><span class="keyword">function</span> parseLodash(str)&#123;</div><div class="line">    <span class="built_in">return</span> _.attempt(JSON.parse.bind(null, str));</div><div class="line">&#125;</div><div class="line"></div><div class="line">parse(<span class="string">'a'</span>);</div><div class="line">// =&gt; <span class="literal">false</span></div><div class="line">parseLodash(<span class="string">'a'</span>);</div><div class="line">// =&gt; Return an error object</div><div class="line"></div><div class="line">parse(<span class="string">'&#123;"name": "colin"&#125;'</span>);</div><div class="line">// =&gt; Return &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>&#125;</div><div class="line">parseLodash(<span class="string">'&#123;"name": "colin"&#125;'</span>);</div><div class="line">// =&gt; Return &#123;<span class="string">"name"</span>: <span class="string">"colin"</span>&#125;</div></pre></td></tr></table></figure>
<p>如果你在使用 JSON.parse 时没有预置错误处理，那么它很有可能会成为一个定时炸弹，我们不应该默认接收的 JSON 对象都是有效的。try-catch 是最常见的错误处理方式，如果项目中 Lodash，那么可以使用 _.attmpt 替代 try-catch 的方式，当解析 JSON 出错时，该方法会返回一个 Error 对象。</p>
<blockquote>
<p>随着 ES6 的普及，Lodash 的功能或多或少会被原生功能所替代，所以使用时还需要进一步甄别，建议优先使用原生函数，有关 ES6 替代 Lodash 的部分，请参考文章<a href="https://www.sitepoint.com/lodash-features-replace-es6/" target="_blank" rel="external">《10 Lodash Features You Can Replace with ES6》</a><a href="http://www.zcfy.cc/article/10-lodash-features-you-can-replace-with-es6-467.html" target="_blank" rel="external">（中文版《10 个可用 ES6 替代的 Lodash 特性》</a>）。</p>
</blockquote>
<p>其中有两处非常值得一看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">// 使用箭头函数创建可复用的路径</div><div class="line">const object = &#123; <span class="string">'a'</span>: [&#123; <span class="string">'b'</span>: &#123; <span class="string">'c'</span>: 3 &#125; &#125;, 4] &#125;;</div><div class="line"></div><div class="line">[</div><div class="line">    obj =&gt; obj.a[0].b.c,</div><div class="line">    obj =&gt; obj.a[1]</div><div class="line">].map(path =&gt; path(object));</div><div class="line"></div><div class="line">// 使用箭头函数编写链式调用</div><div class="line">const pipe = <span class="built_in">functions</span> =&gt; data =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> functions.reduce(</div><div class="line">        (value, func) =&gt; func(value),</div><div class="line">        data</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const pipeline = pipe([</div><div class="line">    x =&gt; x * 2,</div><div class="line">    x =&gt; x / 3,</div><div class="line">    x =&gt; x &gt; 5,</div><div class="line">    b =&gt; !b</div><div class="line">]);</div><div class="line"></div><div class="line">pipeline(5);</div><div class="line">// <span class="literal">true</span></div><div class="line">pipeline(20);</div><div class="line">// <span class="literal">false</span></div><div class="line">在 ES6 中，如果一个函数只接收一个形参且函数体是一个 <span class="built_in">return</span> 语句，就可以使用箭头函数简化为：</div><div class="line"></div><div class="line">const func = p =&gt; v;</div><div class="line"></div><div class="line">// 类似于(不完全相同)</div><div class="line">const func = <span class="keyword">function</span> (p) &#123;</div><div class="line">    <span class="built_in">return</span> v;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当有多重嵌套时，可以简化为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">const func = a =&gt; b =&gt; c =&gt; a + b + c;</div><div class="line">func(1)(2)(3);</div><div class="line">// =&gt; 6</div><div class="line"></div><div class="line">// 类似于</div><div class="line">const func = <span class="keyword">function</span> (a) &#123;</div><div class="line">    <span class="built_in">return</span> <span class="keyword">function</span> (b) &#123;</div><div class="line">        <span class="built_in">return</span> <span class="keyword">function</span> (e) &#123;</div><div class="line">            <span class="built_in">return</span> a + b + c;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://lodash.com/docs/4.17.4" target="_blank" rel="external">Lodash 官方文档</a></li>
<li><a href="https://github.com/lodash/lodash/wiki/FP-Guide" target="_blank" rel="external">Lodash FP Guide</a></li>
<li><a href="https://www.npmjs.com/package/babel-plugin-lodash" target="_blank" rel="external">babel-plugin-lodash</a></li>
<li><a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation/" target="_blank" rel="external">How to Speed Up Lo-Dash ×100? Introducing Lazy Evaluation</a></li>
<li><a href="https://colintoh.com/blog/lodash-10-javascript-utility-functions-stop-rewriting" target="_blank" rel="external">Lodash: 10 Javascript Utility Functions That You Should Probably Stop Rewriting</a></li>
<li><a href="https://www.sitepoint.com/lodash-features-replace-es6/" target="_blank" rel="external">10 Lodash Features You Can Replace with ES6</a></li>
<li><a href="https://colintoh.com/blog/lodash-10-javascript-utility-functions-stop-rewriting" target="_blank" rel="external">Lodash: 10 Javascript Utility Functions That You Should Probably Stop Rewriting</a></li>
</ul>
</div><div class="tags"><a href="/tags/library/">library</a></div><div class="post-share"></div><div class="post-nav"><a href="/2017/07/16/sass和stylus对比介绍/" class="pre">sass和stylus对比介绍</a><a href="/2017/07/13/cygwin常用命令收集/" class="next">cygwin常用命令收集</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#模块组成"><span class="toc-text">模块组成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#性能"><span class="toc-text">性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#九个实例"><span class="toc-text">九个实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-N-次循环"><span class="toc-text">1.N 次循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-深层查找属性值"><span class="toc-text">2.深层查找属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-个性化数组"><span class="toc-text">3.个性化数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-深拷贝"><span class="toc-text">4.深拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-随机数"><span class="toc-text">5.随机数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-对象扩展"><span class="toc-text">6.对象扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-筛选属性"><span class="toc-text">7.筛选属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-随机元素"><span class="toc-text">8.随机元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-针对-JSON-parse-的错误处理"><span class="toc-text">9.针对 JSON.parse 的错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/16/sass和stylus对比介绍/">sass和stylus对比介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/13/lodash/">lodash</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/13/cygwin常用命令收集/">cygwin常用命令收集</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/cli/" style="font-size: 15px;">cli</a> <a href="/tags/library/" style="font-size: 15px;">library</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://ruyuanyuan.github.io" title="oo" target="_blank">oo</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">海阔天空.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script></body></html>